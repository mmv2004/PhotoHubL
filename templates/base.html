{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PhotoHub{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">

    <!-- ВРЕМЕННЫЕ СТИЛИ ДЛЯ ТЕСТА ТЕМЫ -->
    <style>
        /* СВЕТЛАЯ ТЕМА */
        .theme-light {
            background-color: #f9f6f2;
            color: #333333;
        }
        .theme-light .navbar {
            background-color: #f9f6f2 !important;
            border-bottom: 1px solid #c2b9b0 !important;
        }
        .theme-light .sidebar {
            background-color: #f9f6f2 !important;
            border-right: 1px solid #c2b9b0 !important;
        }
        .theme-light .card {
            background-color: #ffffff !important;
            border: 1px solid #c2b9b0 !important;
            color: #333333 !important;
        }
        .theme-light .card-header {
            background-color: #ffffff !important;
            border-bottom: 1px solid #c2b9b0 !important;
            color: #333333 !important;
        }
        .theme-light .table {
            background-color: #ffffff !important;
            color: #333333 !important;
        }
        .theme-light .table th,
        .theme-light .table td {
            background-color: #ffffff !important;
            color: #333333 !important;
            border-color: #c2b9b0 !important;
        }
        .theme-light .nav-link {
            color: #333333 !important;
        }
        .theme-light .nav-link:hover,
        .theme-light .nav-link.active {
            background-color: #e0d7cd !important;
            color: #333333 !important;
        }

        /* ТЕМНАЯ ТЕМА */
        .theme-dark {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .theme-dark .navbar {
            background-color: #1a1a1a !important;
            border-bottom: 1px solid #3a3a3a !important;
        }
        .theme-dark .sidebar {
            background-color: #1a1a1a !important;
            border-right: 1px solid #3a3a3a !important;
        }
        .theme-dark .card {
            background-color: #2d2d2d !important;
            border: 1px solid #3a3a3a !important;
            color: #e0e0e0 !important;
        }
        .theme-dark .card-header {
            background-color: #2d2d2d !important;
            border-bottom: 1px solid #3a3a3a !important;
            color: #e0e0e0 !important;
        }
        .theme-dark .table {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }
        .theme-dark .table th,
        .theme-dark .table td {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
            border-color: #3a3a3a !important;
        }
        .theme-dark .nav-link {
            color: #e0e0e0 !important;
        }
        .theme-dark .nav-link:hover,
        .theme-dark .nav-link.active {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }
        /* Темная тема для календаря */
        .theme-dark .fc {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }

        .theme-dark .fc-daygrid-day-number,
        .theme-dark .fc-col-header-cell-cushion {
            color: #e0e0e0 !important;
        }

        .theme-dark .fc-theme-standard td,
        .theme-dark .fc-theme-standard th {
            border-color: #444444 !important;
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }

        .theme-dark .fc-scrollgrid {
            border-color: #444444 !important;
        }

        .theme-dark .fc-view {
            background-color: #2d2d2d !important;
        }

        /* Темная тема для форм */
        .theme-dark .form-control,
        .theme-dark .form-select,
        .theme-dark .form-textarea {
            background-color: #3a3a3a !important;
            color: #e0e0e0 !important;
            border: 1px solid #555555 !important;
        }

        .theme-dark .form-control:focus,
        .theme-dark .form-select:focus {
            background-color: #3a3a3a !important;
            color: #e0e0e0 !important;
            border-color: #e8a798 !important;
            box-shadow: 0 0 0 0.2rem rgba(232, 167, 152, 0.25) !important;
        }

        .theme-dark .form-control::placeholder {
            color: #999999 !important;
        }

        .theme-dark .input-group-text {
            background-color: #444444 !important;
            color: #e0e0e0 !important;
            border: 1px solid #555555 !important;
        }

        .theme-dark .form-label {
            color: #e0e0e0 !important;
        }

        /* Для выпадающих списков */
        .theme-dark .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23e0e0e0' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e") !important;
        }

        /* Для чекбоксов и радиокнопок */
        .theme-dark .form-check-input {
            background-color: #3a3a3a !important;
            border: 1px solid #555555 !important;
        }

        .theme-dark .form-check-input:checked {
            background-color: #e8a798 !important;
            border-color: #e8a798 !important;
        }

        .theme-dark .form-check-label {
            color: #e0e0e0 !important;
        }

        /* Для переключателей (switches) */
        .theme-dark .form-switch .form-check-input {
            background-color: #444444 !important;
        }

        .theme-dark .form-switch .form-check-input:checked {
            background-color: #e8a798 !important;
        }

        /* Темная тема для кнопок календаря */
        .theme-dark .fc .fc-button-primary {
            background-color: #444444 !important;
            border-color: #555555 !important;
            color: #e0e0e0 !important;
        }

        .theme-dark .fc .fc-button-primary:hover {
            background-color: #555555 !important;
            border-color: #666666 !important;
            color: #ffffff !important;
        }

        .theme-dark .fc .fc-button-primary:not(:disabled).fc-button-active,
        .theme-dark .fc .fc-button-primary:not(:disabled):active {
            background-color: #666666 !important;
            border-color: #777777 !important;
            color: #ffffff !important;
        }

        .theme-dark .fc .fc-button-primary:disabled {
            background-color: #333333 !important;
            border-color: #444444 !important;
            color: #888888 !important;
        }

        /* Дополнительно для всех состояний кнопок */
        .theme-dark .fc .fc-button.fc-button-active {
            background-color: #666666 !important;
            border-color: #777777 !important;
            color: #ffffff !important;
        }

        /* Темная тема для iOS переключателя */
        .theme-dark .ios-toggle {
            background-color: #3a3a3a !important;
        }

        .theme-dark .ios-toggle-option {
            color: #e0e0e0 !important;
        }

        .theme-dark .ios-toggle-option.active {
            background-color: #555555 !important;
            color: #ffffff !important;
        }

        .theme-dark .ios-toggle label {
            color: #e0e0e0 !important;
        }

        .theme-dark .slider {
            background-color: #555555 !important; /* Темный ползунок */
        }

        /* Темная тема для CTA кнопок - прозрачный вариант */
        .theme-dark .btn-cta {
            background-color: #3a3a3a !important;
            border-color: #555555 !important;
            color: #e0e0e0 !important;
        }

        .theme-dark .btn-cta:hover {
            background-color: #444444 !important;
            border-color: #666666 !important;
            color: #ffffff !important;
        }


        .theme-dark .text-muted {
            color: #b0b0b0 !important; /* Светло-серый */
        }

        .theme-dark .bg-primary {
            background-color: #555555 !important;
        }

        .theme-dark .btn-primary {
            background-color: #3a3a3a !important;
            border-color: #3a3a3a !important;
            color: #e0e0e0 !important;
        }

        .theme-dark .btn-primary:hover {
            background-color: #444444 !important;
            border-color: #444444 !important;
            color: #ffffff !important;
        }

        /* Тёмная тема для бейджей категорий */
        .theme-dark .category-badge {
            background-color: #2d2d2d !important;
            color: #b0b0b0 !important;
            border: 1px solid #444444 !important;
        }

        .theme-dark .category-badge.active {
            background-color: #444444 !important;
            color: #e0e0e0 !important;
            border-color: #666666 !important;
        }

        .theme-dark .category-badge:hover {
            background-color: #3a3a3a !important;
            border-color: #555555 !important;
        }

        /* Темная тема для outline-primary кнопок */
        .theme-dark .btn-outline-primary {
            background-color: transparent !important;
            border-color: #b0b0b0 !important; /* Светло-серая граница */
            color: #b0b0b0 !important; /* Светло-серый текст */
        }

        .theme-dark .btn-outline-primary:hover {
            background-color: #b0b0b0 !important; /* Светло-серый фон при ховере */
            border-color: #b0b0b0 !important;
            color: #1a1a1a !important; /* Темный текст при ховере */
        }

        /* Исправление для автозаполнения в темной теме */
        .theme-dark .form-control:-webkit-autofill,
        .theme-dark .form-control:-webkit-autofill:hover,
        .theme-dark .form-control:-webkit-autofill:focus,
        .theme-dark .form-control:-webkit-autofill:active,
        .theme-dark .form-control:autofill,
        .theme-dark .form-control:autofill:hover,
        .theme-dark .form-control:autofill:focus {
            -webkit-text-fill-color: #e0e0e0 !important;
            -webkit-box-shadow: 0 0 0px 1000px #3a3a3a inset !important;
            background-color: #3a3a3a !important;
            color: #e0e0e0 !important;
            border: 1px solid #555555 !important;
            caret-color: #e0e0e0 !important;
        }

        /* Для селектов */
        .theme-dark .form-select:-webkit-autofill,
        .theme-dark .form-select:autofill {
            -webkit-text-fill-color: #e0e0e0 !important;
            -webkit-box-shadow: 0 0 0px 1000px #3a3a3a inset !important;
            background-color: #3a3a3a !important;
        }

        /* Дополнительный хак для надежности */
        .theme-dark input:-internal-autofill-selected {
            background-color: #3a3a3a !important;
            color: #e0e0e0 !important;
        }

        /* Темная тема для поля загрузки файлов */
        .theme-dark .form-control[type="file"] {
            background-color: #3a3a3a !important;
            color: #e0e0e0 !important;
            border: 1px solid #555555 !important;
        }

        .theme-dark .form-control[type="file"]::file-selector-button {
            background-color: #555555 !important;
            color: #e0e0e0 !important;
            border: 1px solid #666666 !important;
            border-right: 1px solid #555555 !important;
        }

        .theme-dark .form-control[type="file"]::file-selector-button:hover {
            background-color: #666666 !important;
            color: #ffffff !important;
        }

        .theme-dark .form-text {
            color: #cccccc !important;
        }

        .theme-dark .navbar-brand {
            color: #ffffff !important;
        }

        /* Принудительное затемнение карты */
        .theme-dark .ymaps-2-1-79-map {
            filter: invert(0.9) hue-rotate(180deg) brightness(0.7) contrast(1.2);
        }

        .theme-dark .ymaps-2-1-79-map img {
            filter: invert(1) hue-rotate(180deg) brightness(1.2) contrast(1.1);
        }

        .theme-dark .map-hint {
            background: #3a3a3a !important;
            color: #e0e0e0 !important;
            border: 1px solid #555555 !important;
        }

        /* ОБЩИЕ СТИЛИ (для обеих тем) */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        .btn-primary {
            background-color: #e8a798 !important;
            border-color: #e8a798 !important;
            color: white !important;
        }
        .btn-primary:hover {
            background-color: #e08f7c !important;
            border-color: #e08f7c !important;
        }
        /* Добавь сюда другие общие стили */
    </style>

    {% block extra_css %}{% endblock %}
</head>
<body data-theme="{% if user.is_authenticated and user.dark_theme %}dark{% else %}light{% endif %}"
      class="{% if user.is_authenticated and user.dark_theme %}theme-dark{% else %}theme-light{% endif %}">



    <!-- Верхняя навигационная панель -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <button class="mobile-menu-toggle d-lg-none me-2" type="button">
                <i class="fas fa-bars"></i>
            </button>

            <a class="navbar-brand" href="{% url 'users:dashboard' %}">PhotoHub</a>

            <div class="ms-auto d-flex align-items-center">
                {% if user.is_authenticated %}

                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            {% if user.avatar %}
                                <img src="{{ user.avatar.url }}" alt="{{ user.get_full_name }}" class="avatar-sm me-2">
                            {% else %}
                                <i class="fas fa-user-circle me-2"></i>
                            {% endif %}
                            {{ user.get_full_name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{% url 'users:profile' %}"><i class="fas fa-user me-2"></i> Профиль</a></li>

                            <!-- Переключатель темы -->
                            <li>
                                <form action="{% url 'users:toggle_theme' %}" method="post" class="dropdown-item-form">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item border-0 bg-transparent w-100 text-start">
                                        <i class="fas {% if user.dark_theme %}fa-sun{% else %}fa-moon{% endif %} me-2"></i>
                                        {% if user.dark_theme %}Светлая тема{% else %}Темная тема{% endif %}
                                    </button>
                                </form>
                            </li>

                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form action="{% url 'users:logout' %}" method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item">
                                        <i class="fas fa-sign-out-alt me-2"></i> Выход
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                {% else %}
                    <a href="{% url 'users:login' %}" class="btn btn-sm btn-primary me-2">Войти</a>
                    <a href="{% url 'users:register' %}" class="btn btn-sm btn-cta">Регистрация</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="d-flex">
        {% if user.is_authenticated %}
            <!-- Боковая панель навигации -->
            <div class="sidebar sidebar-expanded" id="sidebar">
                <div class="sidebar-toggle" id="sidebar-toggle">
                    <i class="fas fa-chevron-left"></i>
                </div>

                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="{% url 'users:dashboard' %}">
                            <i class="fas fa-home"></i> <span class="sidebar-text">Главная</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if '/clients/' in request.path %}active{% endif %}" href="{% url 'clients:client_list' %}">
                            <i class="fas fa-address-book"></i> <span class="sidebar-text">Клиенты</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if '/studios/' in request.path %}active{% endif %}" href="{% url 'studios:studio_list' %}">
                            <i class="fas fa-building"></i> <span class="sidebar-text">Студии и локации</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if '/references/' in request.path %}active{% endif %}" href="{% url 'references:reference_list' %}">
                            <i class="fas fa-images"></i> <span class="sidebar-text">Референсы</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if '/profile/' in request.path %}active{% endif %}" href="{% url 'users:profile' %}">
                            <i class="fas fa-user-cog"></i> <span class="sidebar-text">Настройки профиля</span>
                        </a>
                    </li>
                    {% if user.is_staff %}
                    <li class="nav-item">
                        <a class="nav-link {% if '/admin-dashboard/' in request.path %}active{% endif %}" href="{% url 'users:admin_dashboard' %}">
                            <i class="fas fa-tachometer-alt"></i> <span class="sidebar-text">Панель администратора</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        {% endif %}

        <!-- Основной контент -->
        <div class="content {% if user.is_authenticated %}ms-lg-auto{% endif %}" style="{% if user.is_authenticated %}width: calc(100% - 250px);{% endif %}">
            {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Custom JS -->
    <script src="{% static 'js/base.js' %}"></script>

    <!-- СКРИПТ ДЛЯ ПРИНУДИТЕЛЬНОГО ПРИМЕНЕНИЯ ТЕМЫ -->
    <script>
        // Принудительное применение темы при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            const isDarkTheme = {% if user.is_authenticated and user.dark_theme %}true{% else %}false{% endif %};

            // Применяем тему через классы
            if (isDarkTheme) {
                document.body.classList.add('theme-dark');
                document.body.classList.remove('theme-light');
            } else {
                document.body.classList.add('theme-light');
                document.body.classList.remove('theme-dark');
            }

            console.log('Theme applied:', isDarkTheme ? 'dark' : 'light');
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>